# Agent Guidelines for fin-tech-final

This repository contains a Python-based financial analysis pipeline for processing stock data, running regression models (CAPM, FF3, FF5), and generating reports.

## 1. Build, Lint, and Test Commands

This project uses `uv` for dependency and environment management.

### Environment Setup
- **Install dependencies:**
  ```bash
  uv sync
  ```
- **Add a new package:**
  ```bash
  uv add <package_name>
  ```

### Running the Application
- **Execute the main pipeline:**
  ```bash
  uv run main.py
  ```
  This command fetches data, runs analysis, and generates outputs in `output/`.

### Linting and Formatting
- **Lint code (using Ruff):**
  ```bash
  uv run ruff check .
  ```
- **Format code:**
  ```bash
  uv run ruff format .
  ```
- **Fix linting issues automatically:**
  ```bash
  uv run ruff check --fix .
  ```

### Testing
*Note: If test files exist (e.g., in a `tests/` directory), use the following commands.*

- **Run all tests:**
  ```bash
  uv run pytest
  ```
- **Run a single test file:**
  ```bash
  uv run pytest tests/test_analysis.py
  ```
- **Run a specific test case:**
  ```bash
  uv run pytest tests/test_analysis.py::test_run_regressions
  ```
- **Run tests with verbose output:**
  ```bash
  uv run pytest -v
  ```

## 2. Code Style and Conventions

### Project Structure
- `src/`: Contains core logic modules.
  - `data_fetching.py`: Logic for retrieving data from APIs (yfinance, pandas_datareader).
  - `analysis.py`: Statistical models and regression logic.
  - `plotting.py`: Visualization generation.
- `main.py`: Entry point that orchestrates the workflow.
- `output/`: Generated artifacts (LaTeX tables, images).

### Formatting & Style
- **Indentation:** Use 4 spaces.
- **Line Length:** Follow standard Ruff/Black defaults (88 characters).
- **Quotes:** Use double quotes (`"`) for strings.
- **Imports:**
  - Group imports: Standard library first, then third-party, then local `src` imports.
  - Absolute imports preferred (e.g., `from src.analysis import ...`).

### Naming Conventions
- **Variables/Functions:** `snake_case` (e.g., `run_regressions`, `df_results`).
- **Classes:** `PascalCase`.
- **Constants:** `UPPER_CASE` (e.g., `START_DATE`, `TICKERS`).
- **File Names:** `snake_case` (e.g., `data_fetching.py`).

### Type Hinting
- Currently, the codebase does **not** strictly enforce type hints.
- However, when adding new major functions, simple type hints are encouraged for clarity:
  ```python
  def fetch_data(tickers: list[str], start: str, end: str) -> pd.DataFrame:
  ```

### Error Handling
- Use `try...except` blocks for external API calls (e.g., downloading data).
- Log errors clearly to the console using `print` with emojis for visibility (e.g., `print(f"‚ö†Ô∏è Error: {e}")`).
- Do not suppress errors silently; return `None` or raise appropriately if the pipeline cannot proceed.

### UI/Logging
- The application uses console output with emojis to indicate progress:
  - üöÄ Start/Fetching
  - ‚ö° Analysis/Processing
  - üìù Generating Output
  - ‚úÖ Success
  - ‚ö†Ô∏è Warning/Error

### Documentation
- Use Python docstrings (`"""`) for functions to explain purpose and arguments.
- Example:
  ```python
  def run_regressions(data, tickers):
      """
      Runs CAPM, Fama-French 3-factor, and Fama-French 5-factor regressions.
      """
  ```

### Data Handling
- Use `pandas.DataFrame` as the primary data structure.
- Ensure date indices are properly handled when merging stock data with factors.
- `yfinance` download results often need `['Adj Close']` selection or multi-level index handling.

### Git Commit Conventions
Follow the [Conventional Commits](https://www.conventionalcommits.org/) specification:

**Format:** `<type>(<scope>): <subject>`

**Common Types:**
- `feat`: A new feature
- `fix`: A bug fix
- `docs`: Documentation only changes
- `style`: Changes that do not affect the meaning of the code (white-space, formatting, etc)
- `refactor`: A code change that neither fixes a bug nor adds a feature
- `perf`: A code change that improves performance
- `test`: Adding missing tests or correcting existing tests
- `chore`: Changes to the build process or auxiliary tools and libraries (e.g., uv, ruff)

**Examples:**
- `feat(analysis): add Fama-French 5-factor regression model`
- `fix(data): handle missing ticker data gracefully`
- `docs(readme): update build instructions`
- `style: reformat code with ruff`

---

*Generated by opencode.*
